<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
    <head>
        <script type="text/javascript">
	    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	    ga('create', 'UA-38205696-1', 'zhangwenli.com');
	    ga('send', 'pageview');
        </script>
        
        <meta charset="utf-8" />
        <meta name="description" content="Web Front-End Blog by Wenli Zhang" />
        <meta name="viewport" content="width=100%, initial-scale=1" />
        
        <link rel="shortcut icon" href="http://zhangwenli.com/blog/img/me.ico">
            
        <link rel="stylesheet" type="text/css" href="http://zhangwenli.com/blog/css/syntax.css" />
        <link rel="stylesheet" type="text/css" href="http://zhangwenli.com/blog/css/default.css" />
        
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->
        <script type="text/javascript" src="http://zhangwenli.com/blog/js/lazyLoad.js"></script>
        <script type="text/javascript" src="http://zhangwenli.com/blog/js/common.js"></script>
    </head>
    
    <body>
        <div id="mobile-nav">
            <a href="http://zhangwenli.com/blog">Blog</a><a href="http://zhangwenli.com">About Me</a>
        </div>
        <div id="contentDiv">


<title>Jekyll Related Posts without Plugin
	
</title>
 
<a href="http://zhangwenli.com/blog">
    <div id="homeDiv"></div>
</a>
<div class="rotLeft rotTop pageBack"></div>
<div class="rotRight rotTop pageBack"></div>
<div class="container page">
    <div class="simpleNav">
        <a href="http://zhangwenli.com" class="pageDiv">Home</a>
        <a href="http://zhangwenli.com/blog" class="pageDiv">Blog</a>
    </div>
    
    <div class="pageTitle">Jekyll Related Posts without Plugin</div>
	
	
    
    <div class="time">2014.07.15 22:57:38</div>
            
    <div class="tagPanel">
    
        <a href="http://zhangwenli.com/blog/tags?tag=Jekyll"><div class="tag">Jekyll</div></a>
    
        <a href="http://zhangwenli.com/blog/tags?tag=Liquid"><div class="tag">Liquid</div></a>
    
        <a href="http://zhangwenli.com/blog/tags?tag=GitHub"><div class="tag">GitHub</div></a>
    
        <a href="http://zhangwenli.com/blog/tags?tag=Ruby"><div class="tag">Ruby</div></a>
    
    </div>
    
    <blockquote><h4>What will you learn in this post?</h4>

<p>This post introduces how to implement <em>related posts</em> function with Jekyll. Since GitHub diables plugin for security reasons, plugins like <a href="https://github.com/LawrenceWoodman/related_posts-jekyll_plugin" targe="_blank">LawrenceWoodman / related_posts-jekyll_plugin</a> cannot be used. Default <code>site.related_posts</code> may return recent posts when there aren't enough posts sharing the same tags with current post.</p></blockquote>

<h1>Jekyll's Native Support</h1>

<p>Jekyll has native support for related posts function, which can be used with Liquid as <code>site.related_posts</code>.</p>

<p>However, as we can see from its <a href="https://github.com/jekyll/jekyll/blob/df8458275de4dc3d0f9b92c5247ff20832d1cc8e/lib/jekyll/related_posts.rb" target="_blank">source code</a>, it lists posts with mutual tags without ordering by how many mutual tags they share. In this way, if <code>A</code> post is tagged with <code>a</code>, <code>b</code> and <code>c</code>, <code>B</code> post is tagged with <code>a</code> and <code>C</code> post is tagged with <code>a</code> and <code>c</code>, <code>A</code>'s related posts may contain only <code>B</code> but not <code>C</code> if you set the limit to be <code>1</code>. Apparently, this doesn't make sense.</p>

<h1>Using Plugin</h1>

<p><a href="https://github.com/LawrenceWoodman/related_posts-jekyll_plugin" targe="_blank">LawrenceWoodman / related_posts-jekyll_plugin</a> is an easy-to-use Jekyll plugin to implement <em>related posts</em> feature.</p>

<p>It solves the above problem by calculating how many mutual tags they share and sort by it, as we can see from the <a href="https://github.com/LawrenceWoodman/related_posts-jekyll_plugin/blob/master/_plugins/related_posts.rb" target="_blank">source code</a> below.</p>

<div class="highlight"><pre><code class="ruby"><span class="k">def</span> <span class="nf">related_posts</span><span class="p">(</span><span class="n">posts</span><span class="p">)</span>
    <span class="k">return</span> <span class="o">[]</span> <span class="k">unless</span> <span class="n">posts</span><span class="o">.</span><span class="n">size</span> <span class="o">&gt;</span> <span class="mi">1</span>
    <span class="n">highest_freq</span> <span class="o">=</span> <span class="ss">Jekyll</span><span class="p">:</span><span class="ss">:Post</span><span class="o">.</span><span class="n">tag_freq</span><span class="p">(</span><span class="n">posts</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">max</span>
    <span class="n">related_scores</span> <span class="o">=</span> <span class="no">Hash</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">posts</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">post</span><span class="o">|</span>
        <span class="n">post</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">tag</span><span class="o">|</span>
            <span class="k">if</span> <span class="nb">self</span><span class="o">.</span><span class="n">tags</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="n">post</span> <span class="o">!=</span> <span class="nb">self</span>
                <span class="n">cat_freq</span> <span class="o">=</span> <span class="ss">Jekyll</span><span class="p">:</span><span class="ss">:Post</span><span class="o">.</span><span class="n">tag_freq</span><span class="p">(</span><span class="n">posts</span><span class="p">)</span><span class="o">[</span><span class="n">tag</span><span class="o">]</span>
                <span class="n">related_scores</span><span class="o">[</span><span class="n">post</span><span class="o">]</span> <span class="o">+=</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">highest_freq</span><span class="o">-</span><span class="n">cat_freq</span><span class="p">)</span>
            <span class="k">end</span>
        <span class="k">end</span>
    <span class="k">end</span>

    <span class="ss">Jekyll</span><span class="p">:</span><span class="ss">:Post</span><span class="o">.</span><span class="n">sort_related_posts</span><span class="p">(</span><span class="n">related_scores</span><span class="p">)</span>
<span class="k">end</span>
</code></pre>
</div>


<p>But just as the default Jekyll behaves, it returns recent posts if there aren't enough posts sharing the same tags. I think this doesn't make sense. After all, why should a post called <code>How to become a good programmer</code> be related to <code>I was bitten by a bug yesterday</code> just because there are no other related posts?</p>

<p>So, I improved it with the following code and <a href="https://github.com/Ovilia/related_posts-jekyll_plugin/commit/4562de1b048a5dbce5f533d343be30254427160e" target="_blank">pulled a request</a>.</p>

<div class="highlight"><pre><code class="ruby"><span class="n">related_scores</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">post</span><span class="p">,</span> <span class="n">score</span><span class="o">|</span>
    <span class="k">if</span> <span class="n">score</span> <span class="o">&lt;</span> <span class="mi">0</span>
        <span class="n">related_scores</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">post</span><span class="p">)</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>


<p>I have almost no experience with Ruby, but this isn't too hard for me.</p>

<h1>Without Plugin</h1>

<p>After I've done with the previous improvement and pushed my blog code to GitHub with joy, I found it didn't word! :scream:</p>

<p>I thought it was the cache, but it still doesn't change when I tried to clear the cache and even visit it using a different browser and a different device.</p>

<p>Finally, I realized that this is caused by GitHub's disabling plugins for security concerns. I knew this before, but didn't know that this is the reason I was looking for.</p>

<p>Then, I improved the default one and return only those with mutual tags. It still cost me much time, since the syntax of Liquid is so strange! :weary:</p>

<script src="https://gist.github.com/Ovilia/ea95e762544d84f00281.js"></script>


<p>You can't use <code>!abc</code> to check if <code>abc</code> is <code>false</code>. Instead, you should use <code>abc == false</code>.</p>

<p>You can't use <code>abc++</code> or even <code>abc = abc + 1</code> to increment a variable. Instead, you should use something as strange as  appending a character <code>*</code> at a time, and then check <code>abc.size</code> to get its length as a string and this is how you increment a variable! :joy: But, believe me, this is not the strangest syntax when you use Liquid.</p>

<p>Who can tell me why this syntax is so strange!</p>


    
    
    <blockquote class="relatedPosts">
        
        
            
            
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                        
                        <h4>Similar Posts</h4>
                        <ul>
                        
                        <li class="relatedPost">
                            <a href="http://zhangwenli.com/blog/2014/05/18/jekyll-tag-searching/">Jekyll Tag Searching
                            
                            </a>
                        </li>
                        
                        
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
            
        
            
            
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
            
                
                    
                
                    
                
                    
                
                    
                
            
        
        
            </ul>
        
        
        <h4>Recent Posts</h4>
        <ul>
        
            <li class="relatedPost">
                <a href="http://zhangwenli.com/blog/2014/07/15/jekyll-related-posts-without-plugin/">Jekyll Related Posts without Plugin
                
                </a>
            </li>
        
            <li class="relatedPost">
                <a href="http://zhangwenli.com/blog/2014/06/25/reading-report/">好读书，不求甚解
                
                </a>
            </li>
        
            <li class="relatedPost">
                <a href="http://zhangwenli.com/blog/2014/05/18/jekyll-tag-searching/">Jekyll Tag Searching
                
                </a>
            </li>
        
            <li class="relatedPost">
                <a href="http://zhangwenli.com/blog/2014/05/18/03-dive-into-css/">03 - Dive into CSS
                
                    (Series: Dive into Web Front-End Programming)
                
                </a>
            </li>
        
            <li class="relatedPost">
                <a href="http://zhangwenli.com/blog/2014/05/11/reviewing-moment-in-peking/">道载万物，洋洋大哉
                
                </a>
            </li>
        
        </ul>
    </blockquote>
    
    <div class="license">
        <a rel="license" href="http://creativecommons.org/licenses/by-nc/3.0/">
            <img alt="Creative Commons License" style="border-width:0" src="http://i.creativecommons.org/l/by-nc/3.0/88x31.png" />
        </a>
        <div><span xmlns:dct="http://purl.org/dc/terms/" href="http://purl.org/dc/dcmitype/Text" property="dct:title" rel="dct:type">Every blog post in this site</span> by <a xmlns:cc="http://creativecommons.org/ns#" href="http://zhangwenli.com" property="cc:attributionName" rel="cc:attributionURL">Wenli Zhang</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc/3.0/">Creative Commons Attribution-NonCommercial 3.0 Unported License</a>, based on a work at <a xmlns:dct="http://purl.org/dc/terms/" href="http://github.com/ovilia/blog" rel="dct:source">http://github.com/ovilia/blog</a>. </div>
        <div>You must reference <code>Author: &lt;a href=&quot;http://zhangwenli.com&quot;&gt;Wenli Zhang&lt;/a&gt;</code> explictly along with this license note if you want to re-post the content, either completely or partially.</div>
    </div>
    
    <h1>Comments</h1>
<div id="disqus_thread"></div>
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'wenli'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

</div>
<div class="rotLeft rotBottom pageBack"></div>
<div class="rotRight rotBottom pageBack"></div>

        </div>
        
        <div id="footerDiv">
            <div id="footerImg"></div>
            <div id="footerCnt">
                <div id="footer">
                </div>
            </div>
        </div>
    </body>
</html>

 
